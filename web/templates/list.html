{{define "content"}}
<section class="library">
  <div class="library-header">
    <button type="button" class="filter-toggle" data-filter-toggle>Filters</button>
  </div>
  <aside class="filters" data-filters-panel>
    <div class="filters-header">
      <h3>Filters</h3>
      <button type="button" class="filters-close" data-filter-close>Close</button>
    </div>
    <form method="get" action="/" class="filters-form">
    <label>
      Status
      <select name="status">
        <option value="all" {{if eq .Status "all"}}selected{{end}}>All</option>
        <option value="planned" {{if eq .Status "planned"}}selected{{end}}>Planned</option>
        <option value="watched" {{if eq .Status "watched"}}selected{{end}}>Watched</option>
      </select>
    </label>
    <label>
      Genre
      <select name="genre">
        <option value="">Any</option>
        {{range .Genres}}
        <option value="{{.}}" {{if eq $.Genre .}}selected{{end}}>{{.}}</option>
        {{end}}
      </select>
    </label>
    <label>
      Year from
      <input type="number" name="year_from" min="1900" max="2100" value="{{.YearFrom}}">
    </label>
    <label>
      Year to
      <input type="number" name="year_to" min="1900" max="2100" value="{{.YearTo}}">
    </label>
    <label class="checkbox">
      <input type="checkbox" name="unrated" value="1" {{if .Unrated}}checked{{end}}>
      Unrated only
    </label>
    <label>
      Sort
      <select name="sort">
        <option value="updated" {{if eq .Sort "updated"}}selected{{end}}>Recently updated</option>
        <option value="avg" {{if eq .Sort "avg"}}selected{{end}}>Average rating</option>
        <option value="bf" {{if eq .Sort "bf"}}selected{{end}}>{{.BfName}} rating</option>
        <option value="gf" {{if eq .Sort "gf"}}selected{{end}}>{{.GfName}} rating</option>
        <option value="year" {{if eq .Sort "year"}}selected{{end}}>Year</option>
        <option value="title" {{if eq .Sort "title"}}selected{{end}}>Title</option>
      </select>
    </label>
    </form>
    <div class="filters-actions">
      <form method="post" action="/refresh-tmdb">
        <button type="submit" class="export-button">Refresh TMDB</button>
      </form>
    </div>
  </aside>

  <div class="library-main">
    <section class="grid">
      {{if not .HasResults}}
        <div class="empty">No shows yet. Use “Add” to pull from TMDB.</div>
      {{end}}
      {{range .Shows}}
      <article class="card">
        <a
          class="poster"
          href="/show/{{.ID}}"
          style="view-transition-name: poster-{{.MediaType}}-{{.TMDBID}}"
        >
          {{if .PosterPath.Valid}}
          <img src="{{$.ImageBase}}{{.PosterPath.String}}" alt="{{.Title}}">
          {{else}}
          <div class="poster-placeholder">No poster</div>
          {{end}}
        </a>
        <div class="card-body">
          <div class="title-row">
            <div class="title-left">
              <h3>
                <a
                  href="/show/{{.ID}}"
                  style="view-transition-name: title-{{.MediaType}}-{{.TMDBID}}"
                >{{.Title}}</a>
              </h3>
              {{if .Year.Valid}}<span class="year">{{.Year.Int64}}</span>{{end}}
            </div>
            <div class="card-menu" data-menu>
              <button type="button" class="menu-button" data-menu-button aria-haspopup="true" aria-expanded="false">
                <span class="menu-dots" aria-hidden="true"></span>
              </button>
              <div class="menu-dropdown" data-menu-dropdown>
                <form method="post" action="/delete" data-delete-form>
                  <input type="hidden" name="id" value="{{.ID}}">
                  <button type="submit" class="menu-item danger">
                    Delete
                  </button>
                </form>
              </div>
            </div>
          </div>
          <div class="meta">
            <span class="status {{if .Status}}{{.Status}}{{else}}tbd{{end}}">
              {{if .Status}}{{.Status}}{{else}}TBD{{end}}
            </span>
            <span class="rating-chip {{if not .TMDBRating.Valid}}muted{{end}} no-sep">
              {{if .TMDBRating.Valid}}
                {{formatScore .TMDBRating.Float64}}
                {{if .TMDBVotes.Valid}}
                  <span class="votes">({{formatVotes .TMDBVotes.Int64}})</span>
                {{end}}
              {{else}}
                —
              {{end}}
            </span>
            {{if .Genres.Valid}}<span class="genres no-sep">{{shortGenres .Genres}}</span>{{end}}
          </div>
          <div class="ratings">
            <div class="rating-pill bf">
              <span class="rating-star">★</span>
              <strong>{{ratingText .BfRating}}</strong>
            </div>
            <div class="rating-pill gf">
              <span class="rating-star">★</span>
              <strong>{{ratingText .GfRating}}</strong>
            </div>
            <div class="rating-pill avg">
              <span class="rating-label">Avg</span>
              <strong>{{combinedRating .BfRating .GfRating}}</strong>
            </div>
          </div>
        </div>
      </article>
      {{end}}
    </section>
  </div>
</section>

<script src="/static/list.js" defer></script>
<div class="modal-backdrop" data-confirm-backdrop style="display: none"></div>
<div class="modal" data-confirm-modal style="display: none">
  <div class="modal-card">
    <h3>Delete show?</h3>
    <p>This will remove it from your library.</p>
    <div class="modal-actions">
      <button type="button" class="button-ghost" data-confirm-cancel>Cancel</button>
      <button type="button" class="button-ghost danger" data-confirm-delete>Delete</button>
    </div>
  </div>
</div>
{{end}}
